<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Whitelist – Proyecto RP</title>
<style>
  :root{
    --bg:#0b0f14; --panel:#101823; --panel-2:#0d131d; --muted:#a4b5c6; --text:#e9eef3;
    --brand:#69f7c1; --brand2:#4aa3ff; --accent:#7bd87e; --danger:#ff6b6b; --warn:#ffd166;
    --radius:16px; --shadow:0 10px 30px rgba(0,0,0,.35);
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:radial-gradient(1200px 500px at -20% -20%, rgba(106,247,193,.12), transparent 60%), radial-gradient(1200px 500px at 120% -30%, rgba(74,163,255,.10), transparent 60%), var(--bg);color:var(--text);font:500 16px/1.5 Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial}
  .wrap{min-height:100%;padding:20px;display:grid;place-items:center}
  .card{width:min(1100px,100%);background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.02)) , var(--panel);border:1px solid rgba(255,255,255,.08);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden}
  header{display:flex;justify-content:space-between;align-items:center;gap:14px;padding:18px 22px;border-bottom:1px solid rgba(255,255,255,.08);background:radial-gradient(900px 250px at 0% -40%, rgba(106,247,193,.25), transparent 60%),radial-gradient(900px 250px at 100% -40%, rgba(74,163,255,.25), transparent 60%)}
  .brand{display:flex;align-items:center;gap:12px}
  .logo{width:44px;height:44px;border-radius:12px;background:linear-gradient(135deg, var(--brand), var(--brand2));display:grid;place-items:center;color:#0b0f14;font-weight:900}
  .title{font-size:18px;font-weight:900;letter-spacing:.3px}
  .muted{color:var(--muted);font-weight:600;font-size:14px}
  .content{padding:18px 18px 20px}
  .grid{display:grid;grid-template-columns:1fr 1.1fr;gap:16px}
  @media (max-width: 980px){ .grid{grid-template-columns:1fr} }
  .section{background:var(--panel-2);border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:14px}
  h3{margin:0 0 8px;font-size:16px}
  .field{display:flex;flex-direction:column;gap:6px;margin-bottom:10px}
  .label{font-size:13px;color:var(--muted);font-weight:800;letter-spacing:.25px}
  .input,.select,textarea{background:#0e141e;color:var(--text);border:1px solid rgba(255,255,255,.10);border-radius:10px;padding:10px 12px;outline:none;transition:border .15s ease,box-shadow .15s ease}
  .input:focus,.select:focus,textarea:focus{border-color:rgba(74,163,255,.6);box-shadow:0 0 0 3px rgba(74,163,255,.18)}
  textarea{min-height:110px;resize:vertical}
  .progress{display:flex;align-items:center;gap:6px;margin:6px 0 12px}
  .bar{flex:1;height:8px;background:#0d141c;border:1px solid rgba(255,255,255,.08);border-radius:999px;overflow:hidden}
  .bar>span{display:block;height:100%;background:linear-gradient(90deg,var(--brand),var(--brand2));width:0%}
  .tag{font-size:12px;color:var(--muted)}
  .q-wrap{display:flex;flex-direction:column;gap:10px}
  .q-block{border:1px solid rgba(255,255,255,.10);border-radius:12px;overflow:hidden}
  .q-head{background:rgba(255,255,255,.04);padding:10px 12px;font-weight:800}
  .q-body{padding:10px 12px;display:flex;flex-direction:column;gap:8px}
  label.option{display:flex;gap:10px;align-items:flex-start;background:#0e1520;border:1px solid rgba(255,255,255,.09);border-radius:10px;padding:10px 12px;cursor:pointer;transition:border .15s ease, box-shadow .15s ease}
  label.option:hover{border-color:rgba(74,163,255,.5);box-shadow:0 0 0 3px rgba(74,163,255,.14)}
  .controls{display:flex;gap:8px;justify-content:space-between;align-items:center;margin-top:10px;flex-wrap:wrap}
  .btn{border:1px solid rgba(255,255,255,.12);border-radius:11px;padding:10px 14px;background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02));color:var(--text);font-weight:800;cursor:pointer;user-select:none}
  .btn[disabled]{opacity:.55;cursor:not-allowed}
  .btn-primary{background:linear-gradient(180deg,#4aa3ff,#3a7ed8);color:#0b0f14;border-color:transparent}
  .btn-success{background:linear-gradient(180deg,#7bd87e,#46b34b);color:#0b0f14;border-color:transparent}
  .btn-danger{background:linear-gradient(180deg,#ff8d8d,#ff6b6b);color:#0b0f14;border-color:transparent}
  .note{font-size:13px;color:var(--muted)}
  .pill{background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.10);border-radius:999px;padding:4px 8px;font-size:12px}
  .summary{display:grid;grid-template-columns:1fr;gap:12px}
  .kv{display:grid;grid-template-columns:160px 1fr;gap:10px;align-items:center}
  @media (max-width:640px){ .kv{grid-template-columns:1fr} }
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <header>
      <div class="brand">
        <div class="logo">WL</div>
        <div>
          <div class="title">Whitelist – Proyecto RP</div>
          <div class="muted">Formulario + test de conocimientos/situaciones</div>
        </div>
      </div>
      <div class="muted" id="statusTag">Paso 1 / 3</div>
    </header>
    <div class="content">

      <div class="grid" id="step1">
        <div class="section">
          <h3>Datos del jugador</h3>
          <div class="field">
            <label class="label" for="discord">Nombre de Discord</label>
            <input class="input" id="discord" placeholder="Ej: Laury" />
          </div>
          <div class="field">
            <label class="label" for="edad">Edad</label>
            <input class="input" id="edad" type="number" min="14" max="99" />
          </div>
          <div class="field">
            <label class="label" for="region">País/Región</label>
            <input class="input" id="region" placeholder="Ej: España" />
          </div>
          <div class="field">
            <label class="label" for="conoces">¿Cómo nos conociste?</label>
            <input class="input" id="conoces" placeholder="Ej: TikTok, amigo, Twitch…" />
          </div>
          <div class="field">
            <label class="label" for="exp">Experiencia en RP</label>
            <textarea id="exp" placeholder="Cuéntanos tu bagaje"></textarea>
          </div>
        </div>

        <div class="section">
          <h3>Progreso</h3>
          <div class="progress">
            <div class="bar"><span id="bar"></span></div>
            <span class="pill" id="pill">0%</span>
          </div>
          <p class="note">Cuando pulses “Empezar test” pasaremos a las preguntas. Se habilitará “Siguiente” solo cuando respondas.</p>
          <div class="controls">
            <button class="btn btn-primary" id="startBtn">Empezar test</button>
          </div>
        </div>
      </div>

      <div id="step2" style="display:none">
        <div class="section">
          <div class="controls" style="margin-bottom:8px">
            <span class="pill" id="catPill">—</span>
            <span class="note" id="qIndex">Pregunta 1 de N</span>
          </div>
          <div class="q-wrap">
            <div class="q-block">
              <div class="q-head" id="qTitle">Pregunta</div>
              <div class="q-body" id="qBody"></div>
            </div>
          </div>
          <div class="controls">
            <button class="btn" id="prevBtn">Anterior</button>
            <div style="display:flex; gap:8px">
              <button class="btn" id="omitBtn">Omitir</button>
              <button class="btn btn-primary" id="nextBtn" disabled>Siguiente</button>
            </div>
          </div>
        </div>
      </div>

      <div id="step3" style="display:none">
        <div class="section">
          <h3>Resumen</h3>
          <div class="summary">
            <div class="kv"><div class="label">Discord</div><div id="sDiscord">—</div></div>
            <div class="kv"><div class="label">Edad</div><div id="sEdad">—</div></div>
            <div class="kv"><div class="label">Región</div><div id="sRegion">—</div></div>
            <div class="kv"><div class="label">Nos conociste por</div><div id="sConoces">—</div></div>
            <div class="kv"><div class="label">Experiencia</div><div id="sExp">—</div></div>
            <div class="kv"><div class="label">Puntuación</div><div id="sScore">—</div></div>
          </div>
          <div class="controls" style="margin-top:12px">
            <button class="btn" id="backToTest">Volver al test</button>
            <button class="btn btn-success" id="sendBtn">Enviar whitelist</button>
          </div>
          <p class="note" id="sendNote">Los datos se enviarán por un Webhook al staff para revisión.</p>
        </div>
      </div>

    </div>
  </div>
</div>

<script>
const QUESTIONS = [{"category":"Conocimientos","question":"Cuál de los siguientes conceptos no es sancionable?","answers":[{"text":"CK","isCorrect":true},{"text":"MG","isCorrect":false},{"text":"RK","isCorrect":false},{"text":"PK","isCorrect":true},{"text":"IDP","isCorrect":true},{"text":"DM","isCorrect":false}]},{"category":"Conocimientos","question":"¿Cuando se permite hacer MG?","answers":[{"text":"Cuando tu personaje tenga mucha prisa.","isCorrect":false},{"text":"Cuando quieras resolver un conflicto rapidamente.","isCorrect":false},{"text":"Nunca, el metagaming está prohibido en todo momento.","isCorrect":true}]},{"category":"Conocimientos","question":"¿Cuándo se permite el RK?","answers":[{"text":"Cuando te han matado","isCorrect":false},{"text":"Nunca, excepto en casos muy contados que el staff dicte por resolución de una situación.","isCorrect":true},{"text":"Cuando quieras volver donde te ha matado un usuario y querer buscar tus cosas para recuperar tu inventario.","isCorrect":false}]},{"category":"Conocimientos","question":"¿Qué es el PG y qué significa?","answers":[{"text":"Significa PowerGaming y se trata de evitar conductas o acciones irreales que un humano no realizaría.","isCorrect":true},{"text":"Significa PoliceGaming y es hacer roles de policía sin pertenecer al cuerpo.","isCorrect":false},{"text":"Significa PlayerGaming y consiste en usar hacks para ganar.","isCorrect":false}]},{"category":"Conocimientos","question":"¿Qué está permitido hacer en ROL con un streamer?","answers":[{"text":"No existe ninguna norma especial por ser streamer, se trata como todos los usuarios.","isCorrect":true},{"text":"Se debe proporcionar información adicional por streaming para facilitar su rol.","isCorrect":false},{"text":"Siempre se debe favorecer al streamer.","isCorrect":false}]},{"category":"Conocimientos","question":"¿Cuál es la forma correcta de actuar ante una situación de RDM?","answers":[{"text":"Respondes con RDM para equilibrar la situación.","isCorrect":false},{"text":"Intentas resolverlo con diálogo y, si es necesario, reportas con pruebas al staff.","isCorrect":true},{"text":"Ignoras la situación y sigues con tu rol.","isCorrect":false}]},{"category":"Conocimientos","question":"¿Qué significa 'L' o 'W' en el contexto del rol?","answers":[{"text":"Se refiere a ganar (W) o perder (L) en una situación de rol; no deben ser el objetivo del rol.","isCorrect":true},{"text":"Es un comando del juego para lanzar dados.","isCorrect":false},{"text":"Significa 'Local' o 'World' chat.","isCorrect":false}]},{"category":"Conocimientos","question":"¿Qué es el miedo al rol (fearRP)?","answers":[{"text":"Actuar sin tener en cuenta el peligro real para tu personaje.","isCorrect":false},{"text":"Actuar de forma coherente mostrando miedo en situaciones de riesgo real para tu personaje.","isCorrect":true},{"text":"Ignorar a las fuerzas del orden.","isCorrect":false}]},{"category":"Conocimientos","question":"¿A qué se refieren las siglas OOC?","answers":[{"text":"Se refiere a las conversaciones por voz dentro del juego.","isCorrect":false},{"text":"Se refiere a las conversaciones y acciones que están fuera de rol y no afectan la narrativa del personaje.","isCorrect":true},{"text":"Se refiere a las conversaciones que ocurren exclusivamente en el chat del juego.","isCorrect":false}]},{"category":"Conocimientos","question":"¿Qué es el RDE y qué significa?","answers":[{"text":"Significa Rol de Entorno, son ciudadanos, cámaras, etc. que son parte del entorno y sirven para realizar una interpretación correcta en la ciudad.","isCorrect":true},{"text":"Significa Roll Death Eyes, son los NPC que estan cerca","isCorrect":false},{"text":"Significa Realidad de Entorno y solo aplica en eventos.","isCorrect":false}]},{"category":"Situaciones","question":"Te encuentras en una situación en la que una persona apunta con un arma a tu personaje, ¿cómo reaccionas?","answers":[{"text":"Saco un arma y me defiendo inmediatamente.","isCorrect":false},{"text":"Coopero mostrando miedo y sigo las instrucciones para proteger la vida de mi personaje.","isCorrect":true},{"text":"Huyo corriendo ya que tengo mucha vida.","isCorrect":false}]},{"category":"Situaciones","question":"Has visto a alguien usando información fuera de rol para localizar a otro jugador, ¿qué haces?","answers":[{"text":"Lo ignoras, total no te afecta directamente.","isCorrect":false},{"text":"Se lo comunicas al staff con pruebas para que se tomen las medidas necesarias.","isCorrect":true},{"text":"Te unes para no quedarte atrás en la acción.","isCorrect":false}]},{"category":"Situaciones","question":"Te encuentras con una situación de 'tiroteo' en progreso, ¿qué haces si no estás involucrado?","answers":[{"text":"Te acercas a grabar para tu contenido.","isCorrect":false},{"text":"Mantienes distancia y evitas interferir para no romper el desarrollo del rol.","isCorrect":true},{"text":"Les gritas por el chat para que paren.","isCorrect":false}]},{"category":"Situaciones","question":"Tu personaje es detenido por la policía en un control rutinario, ¿qué actitud mantienes?","answers":[{"text":"Actúas con respeto y colaboras con el rol, aceptando las consecuencias.","isCorrect":true},{"text":"Insultas y abandonas el juego para evitar la sanción.","isCorrect":false},{"text":"Intentas huir a toda costa aunque sea irrealista.","isCorrect":false}]},{"category":"Situaciones","question":"Te toca interpretar una escena donde tu personaje está herido de gravedad, ¿cómo procedes?","answers":[{"text":"Ignoras las heridas si nadie te ve.","isCorrect":false},{"text":"Mantienes coherencia con el estado del personaje y sigues las limitaciones de movimiento.","isCorrect":true},{"text":"Sigues roleando como si nada pasara.","isCorrect":false}]},{"category":"Situaciones","question":"Has muerto en una escena de rol, ¿qué haces?","answers":[{"text":"Vuelves al lugar inmediatamente para recuperar tus pertenencias.","isCorrect":false},{"text":"Respetas el NLR/RK y no regresas al punto del rol a menos que el staff lo indique.","isCorrect":true},{"text":"Pides a un amigo que te lleve de vuelta para recuperar todo.","isCorrect":false}]},{"category":"Situaciones","question":"Estás en una persecución y decides salir del juego por lag, ¿qué haces después?","answers":[{"text":"No vuelvo porque total es un juego.","isCorrect":false},{"text":"Aviso por el canal correspondiente y regreso para continuar el rol o me reporto al staff.","isCorrect":true},{"text":"Vuelvo pero actúo como si nada hubiera pasado.","isCorrect":false}]},{"category":"Situaciones","question":"Un streamer entra en escena contigo, ¿cómo procedes?","answers":[{"text":"Lo trato como a cualquier usuario, manteniendo el rol sin favoritismos.","isCorrect":true},{"text":"Le doy ventaja para que tenga mejor contenido.","isCorrect":false},{"text":"Evito el rol porque puede ser incómodo.","isCorrect":false}]}];

const webhookURL = "/discord/api/webhooks/1385716193066745997/ZoQ-DRAkE9ilPSQZQ23gU1b6uT3U_tMQ8Qcpmgx_2AvyrG8c1Ey75iAVeWKJ4wcKky-e";

const state = {
  step: 1,
  i: 0,
  answers: [], // each: { index, chosen: [indices], correct: boolean }
};

const el = (s)=>document.querySelector(s);
const bar = el("#bar"); const pill=el("#pill"); const statusTag=el("#statusTag");
function setProgress(p){ bar.style.width = p + "%"; pill.textContent = Math.round(p)+"%"; }

function showStep(n) {
  state.step = n;
  el("#step1").style.display = n===1? "block":"none";
  el("#step2").style.display = n===2? "block":"none";
  el("#step3").style.display = n===3? "block":"none";
  statusTag.textContent = "Paso " + n + " / 3";
}

function startTest(){
  if(!el("#discord").value.trim()){ alert("Pon tu nombre de Discord."); return; }
  setProgress(5); showStep(2); state.i = 0; renderQ();
}

function renderQ(){
  const q = QUESTIONS[state.i];
  el("#qTitle").textContent = q.question;
  el("#catPill").textContent = q.category;
  el("#qIndex").textContent = "Pregunta " + (state.i+1) + " de " + QUESTIONS.length;

  const body = el("#qBody"); body.innerHTML = "";
  const multi = q.answers.filter(a=>a.isCorrect).length > 1;
  q.answers.forEach((a,idx)=>{
    const lab = document.createElement("label"); lab.className="option";
    const input = document.createElement("input");
    input.type = multi ? "checkbox" : "radio";
    input.name = "q";
    input.value = idx;
    input.addEventListener("change",()=>{ el("#nextBtn").disabled = body.querySelectorAll("input:checked").length===0; });
    const span = document.createElement("span"); span.textContent = a.text;
    lab.appendChild(input); lab.appendChild(span);
    body.appendChild(lab);
  });
  el("#nextBtn").disabled = true;
  setProgress(5 + (state.i/QUESTIONS.length)*85);
}

function collectCurrentAnswer(omit=false){
  const q = QUESTIONS[state.i];
  const body = el("#qBody");
  const selected = Array.from(body.querySelectorAll("input:checked")).map(i=>Number(i.value));
  const correctSet = new Set(q.answers.map((a,i)=>a.isCorrect?i:null).filter(i=>i!==null));
  const chosenSet = new Set(selected);
  let correct = true;
  if(!omit){
    for(const i of chosenSet) if(!correctSet.has(i)) correct=false;
    if(correct) for(const i of correctSet) if(!chosenSet.has(i)) correct=false;
  } else {
    correct = false;
  }
  state.answers[state.i] = { index: state.i, chosen: omit? [] : selected, correct };
}

function next(){
  collectCurrentAnswer(false);
  if(state.i < QUESTIONS.length-1){ state.i++; renderQ(); }
  else { showSummary(); }
}
function omit(){
  collectCurrentAnswer(true);
  if(state.i < QUESTIONS.length-1){ state.i++; renderQ(); }
  else { showSummary(); }
}
function prev(){
  if(state.i===0) return;
  state.i--; renderQ();
  const saved = state.answers[state.i];
  if(saved && saved.chosen){
    saved.chosen.forEach(v=>{
      const input = el("#qBody").querySelector(`input[value="${v}"]`); if(input) input.checked=true;
    });
    el("#nextBtn").disabled = saved.chosen.length===0;
  }
}

function showSummary(){
  const score = state.answers.reduce((acc,a)=> acc + (a && a.correct ? 1 : 0), 0);
  el("#sDiscord").textContent = el("#discord").value || "—";
  el("#sEdad").textContent = el("#edad").value || "—";
  el("#sRegion").textContent = el("#region").value || "—";
  el("#sConoces").textContent = el("#conoces").value || "—";
  el("#sExp").textContent = el("#exp").value || "—";
  el("#sScore").textContent = score + " / " + QUESTIONS.length;
  setProgress(100); showStep(3);
}

async function send(){
  const score = state.answers.reduce((acc,a)=> acc + (a && a.correct ? 1 : 0), 0);
  const results = QUESTIONS.map((q, i)=>{
    const saved = state.answers[i] || { chosen: [] };
    return {
      question: q.question,
      chosen: saved.chosen.map(idx => q.answers[idx]?.text || ""),
      correct: !!(state.answers[i] && state.answers[i].correct)
    };
  });

  const body = {
    username: "Whitelist",
    embeds: [{
      title: "Nueva solicitud de Whitelist",
      color: 0x4aa3ff,
      description: (el("#exp").value || "Sin experiencia"),
      fields: [
        { name: "Discord", value: el("#discord").value || "—", inline: true },
        { name: "Edad", value: el("#edad").value || "—", inline: true },
        { name: "Región", value: el("#region").value || "—", inline: true },
        { name: "Conociste por", value: el("#conoces").value || "—", inline: true },
        { name: "Puntuación", value: score + " / " + QUESTIONS.length, inline: true }
      ],
      footer: { text: "Enviado desde Activity de Discord" },
      timestamp: new Date().toISOString()
    }],
  };

  try {
    el("#sendNote").textContent = "Enviando…";
    const r = await fetch(webhookURL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(body)
    });
    if(!r.ok) throw new Error("HTTP " + r.status);
    el("#sendNote").textContent = "¡Enviado! El staff revisará tu solicitud.";
  } catch(e) {
    el("#sendNote").textContent = "Error al enviar. Revisa consola.";
    console.error(e);
  }
}

// events
el("#startBtn").addEventListener("click", startTest);
el("#nextBtn").addEventListener("click", next);
el("#omitBtn").addEventListener("click", omit);
el("#prevBtn").addEventListener("click", prev);
el("#backToTest").addEventListener("click", ()=> showStep(2));
el("#sendBtn").addEventListener("click", send);

showStep(1); setProgress(0);
</script>
</body>
</html>



